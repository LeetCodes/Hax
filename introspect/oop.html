<!DOCTYPE html>
<meta charset=utf-8>
<meta name=viewport content="width=device-width, initial-scale=1, maximum-scale=1">

<title>JSON-RPC</title>

<link rel=stylesheet type=text/css href="http://yui.yahooapis.com/3.5.1/build/cssreset/cssreset-min.css">
<link rel=stylesheet type=text/css href="http://yui.yahooapis.com/3.5.1/build/cssbase/cssbase-min.css">
<style>
	ul, ol, li {
		list-style: none;
		margin-top:0;
	}
	[data-type] {
		white-space: pre;
		margin-left:2em;
	}
</style>

<body>
<div id=header></div>
<div id=menu></div>
<div id=output></div>
<div style="clear:both;"></div>

<script>window.DEBUG = true</script>
<script src=jquery.js></script>
<script src=Q.js></script>
<script src=parseURL.js></script>
<script src=../js/json.js></script>
<script>
(function () {
	"use strict";
	
	if (window.JSONRPC === undefined) window.JSONRPC = { };
	
	window.JSONRPC.Message = function (method, params, id) {
		if (typeof method !== 'string') return toString();
		this.method = method;
		if (params !== undefined) this.params = params;
		if (id) this.id = true;
	};
	window.JSONRPC.Message.id = 0;
	window.JSONRPC.Message.prototype.toString = function () {
		var message = {
			'jsonrpc': '2.0',
			'method': this.method,
			'params': this.params,
			'id': this.id
		};
		return JSON.stringify(message);
	};
	
	window.JSONRPC.Server = function (address) {
		this.lastID = 0;
		if (address !== undefined) this.address = address;
	}
	window.JSONRPC.Server.prototype.send = function (message) {
		if (message.id !== undefined) {
			message.id = this.lastID++;
		}
		console.log('to '+this.address+': '+message);
	};
	
})();
(function (window, $, undefined) {
	"use strict";
	
	var server = new window.JSONRPC.Server('192.168.0.102');
	var message = new window.JSONRPC.Message('m',[[['']]],true);
	var notification = new window.JSONRPC.Message('m',[[['']]],false);
	
	server.send(message);
	server.send(notification);
	message = new window.JSONRPC.Message('m',[[['']]],true);
	server.send(message);

})(window, jQuery, undefined);

</script>
