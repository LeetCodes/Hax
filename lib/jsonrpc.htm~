<!DOCTYPE html>
<meta charset=utf-8>
<title>JSONRPC TEST</title>
<body lang=en>
<script src="jquery.js"></script>
<script src="jsonrpc.js"></script>
<script>

jQuery(function () {

	var parseURL = function (url, func) {
		var temp = document.createElement('a');
		temp.href = url;
		if (func instanceof Function) func.apply(temp);
		return temp.href;
	};

	var connect = function (url, onConnect) {
	 
		var rpc = JSONRPC(url);
	
		var upgradeToSocket = function () {
			var ws = JSONRPC(parseURL(url, function () {
				if (this.protocol === 'https:') this.protocol = 'wss:';
				else this.protocol = 'ws:';
				this.port = 9090;
			}));
			ws.onConnect(function () {
				var ajax = rpc;
				rpc = ws; //replace ajax transport with websocket
				if (onConnect instanceof Function) onConnect();
			});
		};
	
		rpc.sendMessage('JSONRPC.Version', function (data) {
			if (data.result.version >= 5) upgradeToSocket();	
		});
		
		return rpc;
	};
	
	var connection = connect('/jsonrpc', function () {
		connection.onNotification('Player.OnPlay', function (data) {
			console.log('Playing', data);
		});
		connection.sendMessage('JSONRPC.Introspect', function (data) {
			console.log('Introspect', data);	
		});
	});
});

</script>
